; PDQminer - PlatformIO Configuration
; High-performance ESP32 Bitcoin miner firmware

[platformio]
default_envs = cyd_ili9341
src_dir = src
test_dir = test

[env]
platform = espressif32@6.5.0
framework = arduino
monitor_speed = 115200
upload_speed = 921600
board_build.f_cpu = 240000000L
board_build.flash_mode = qio

build_flags =
    -DCORE_DEBUG_LEVEL=0
    -DPDQ_VERSION=\"0.1.0\"
    -O3
    -funroll-loops
    -ffast-math

build_src_filter = +<*> -<main_benchmark.cpp>

lib_deps =
    bblanchon/ArduinoJson@^7.0.0
    prampec/IotWebConf@^3.2.1

; =============================================================================
; CYD Boards - ESP32-2432S028R (Cheap Yellow Display)
; =============================================================================

[env:cyd_ili9341]
board = esp32dev
build_flags =
    ${env.build_flags}
    -DPDQ_BOARD_CYD
    -DPDQ_DISPLAY_ILI9341
    -DUSER_SETUP_LOADED
    -DILI9341_DRIVER
    -DTFT_WIDTH=240
    -DTFT_HEIGHT=320
    -DTFT_MISO=12
    -DTFT_MOSI=13
    -DTFT_SCLK=14
    -DTFT_CS=15
    -DTFT_DC=2
    -DTFT_RST=-1
    -DTFT_BL=21
    -DTOUCH_CS=33
    -DSPI_FREQUENCY=55000000
build_src_filter = +<*> -<main_benchmark.cpp>
lib_deps =
    ${env.lib_deps}
    bodmer/TFT_eSPI@^2.5.43

[env:cyd_st7789]
board = esp32dev
build_flags = 
    ${env.build_flags}
    -DPDQ_BOARD_CYD
    -DPDQ_DISPLAY_ST7789
    -DUSER_SETUP_LOADED
    -DST7789_DRIVER
    -DTFT_WIDTH=240
    -DTFT_HEIGHT=320
    -DTFT_MISO=12
    -DTFT_MOSI=13
    -DTFT_SCLK=14
    -DTFT_CS=15
    -DTFT_DC=2
    -DTFT_RST=-1
    -DTFT_BL=21
    -DTOUCH_CS=33
    -DSPI_FREQUENCY=55000000
lib_deps = 
    ${env.lib_deps}
    bodmer/TFT_eSPI@^2.5.43

; =============================================================================
; Headless Builds - Maximum hashrate, no display overhead
; =============================================================================

[env:cyd_ili9341_headless]
board = esp32dev
build_flags = 
    ${env.build_flags}
    -DPDQ_BOARD_CYD
    -DPDQ_HEADLESS

[env:esp32_headless]
board = esp32dev
build_flags = 
    ${env.build_flags}
    -DPDQ_HEADLESS

; =============================================================================
; Development & Debug
; =============================================================================

[env:cyd_debug]
board = esp32dev
build_type = debug
build_flags =
    ${env.build_flags}
    -DPDQ_BOARD_CYD
    -DPDQ_DISPLAY_ILI9341
    -DCORE_DEBUG_LEVEL=4
    -DPDQ_DEBUG
    -Og
lib_deps =
    ${env.lib_deps}
    bodmer/TFT_eSPI@^2.5.43

; =============================================================================
; Benchmark Build - Raw hashrate measurement without WiFi/Stratum
; =============================================================================

[env:benchmark]
board = esp32dev
build_flags =
    ${env.build_flags}
    -DPDQ_HEADLESS
    -DPDQ_BENCHMARK
build_src_filter = +<*> -<main.cpp> +<main_benchmark.cpp>

; =============================================================================
; Native Tests (runs on host machine)
; =============================================================================

[env:native]
platform = native
build_flags =
    -DPDQ_NATIVE_TEST
    -std=c++17
test_framework = unity
